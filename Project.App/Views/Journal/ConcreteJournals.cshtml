@using Project.App.ViewModels
@using Project.Entities
@model Project.App.ViewModels.ConcreteJournalModels.IndexViewModel
@addTagHelper "*, Project.App"

@{
    ViewData["Title"] = "ConcreteJournals";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h2>ConcreteJournals</h2>

<form method="get">
    <div class="form-group form-inline">
        <label class="control-label">Title: </label>
        @Html.TextBox("name", Model.FilterViewModel.SelectedTitle, htmlAttributes: new { @class = "form-control" })
        <label class="control-label">Journal: </label>
        @Html.DropDownList("journal", Model.FilterViewModel.Journals as SelectList,
                htmlAttributes: new { @class = "form-control" })
        <label class="control-label">Category: </label>
        @Html.DropDownList("category", Model.FilterViewModel.Categories as SelectList,
                htmlAttributes: new { @class = "form-control" })
        <input type="submit" value="Filter" class="btn btn-default" />
    </div>
</form>
<table class="table">
    <tr>
        <th>
            <a asp-action="ConcreteJournals"
               asp-route-sortOrder="@(Model.SortViewModel.TitleSort)"
               asp-route-name="@(Model.FilterViewModel.SelectedTitle)"
               asp-route-category="@(Model.FilterViewModel.SelectedCategory)"
               asp-route-journal="@(Model.FilterViewModel.SelectedJournal)">Title</a>
        </th>
        <th>
            <a asp-action="ConcreteJournals" asp-route-sortOrder="@(Model.SortViewModel.JournalSort)"
               asp-route-name="@(Model.FilterViewModel.SelectedTitle)"
               asp-route-category="@(Model.FilterViewModel.SelectedCategory)"
               asp-route-journal="@(Model.FilterViewModel.SelectedJournal)">Journal</a>
        </th>
        <th>
            <a asp-action="ConcreteJournals" asp-route-sortOrder="@(Model.SortViewModel.DateSort)"
               asp-route-name="@(Model.FilterViewModel.SelectedTitle)"
               asp-route-category="@(Model.FilterViewModel.SelectedCategory)"
               asp-route-journal="@(Model.FilterViewModel.SelectedJournal)">Date</a>
        </th>
        <th>
            Categories
        </th>
    </tr>
    @foreach (Concretejournal j in Model.Journals)
    {
        string categories = "";
        j.Journalarticles.ToList().ForEach(x =>
        {
            x.JournalarticleSubcategories.ToList().ForEach(y => 
            { 
            if(!categories.Contains(y.Subcategory.Name)) categories += y.Subcategory.Name + ", ";
            }
            );
    });
    categories.Trim();
    categories = categories == "" ? categories : categories.Remove(categories.Count() - 2);
        <tr><td>@j.Journal.Title Nr.@j.Number</td><td>@j.Journal.Title</td><td>@j.Date</td><td>@categories</td></tr>
    }
</table>
<page-link page-model="Model.PageViewModel" page-action="Index"
           page-url-name="@(Model.FilterViewModel.SelectedTitle)"
           page-url-journal="@(Model.FilterViewModel.SelectedJournal)"
           page-url-category="@(Model.FilterViewModel.SelectedCategory)"
           page-url-sortorder="@(Model.SortViewModel.Current)"></page-link>

